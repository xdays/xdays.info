---
title: CCNA-静态路由和RIP
date: 2010-10-30
author: admin
category: ccna
tags: ccna, cisco, rip, static
slug: ccna-静态路由和rip
---

-   静态路由
    -   路由全过程
    -   路由表原理
    -   带下一跳或送出接口的静态路由
    -   默认路由
-   路由信息协议（routing infomation protocol，RIP）
    -   度量和管理距离
    -   路由环路及解决办法
    -   RIP的各种定时器
    -   配置相关命令
    -   连续网络问题
    -   RIPv2与RIPv1的区别

### 静态路由

#### 路由全过程

数据在位于不同网段内的两个主机之间传播经过了那些过程，在《CCNA学习指南》第六章的“路由基础”节“IP路由选择过程”小节分36步详细说明，这里略过

#### 路由表原理

一下这三条原理出自《 cisco ip routing
》，相当经典，先记下这三条路由原则，在以后的路由学习过程中逐渐体会才能真正理解其含义：

1.  每个路由器根据自身的路由表独立作出路径选择
2.  一台路由器中包含的某些信息并不表示其他路由器也有相同的信息
3.  一个网络到达另一个网络的路由信息并提供反向路径的路由信息

#### 带下一跳或者带送出接口的静态路由

在配置静态路由时可以指定下一跳地址或者送出接口，两者区别就在于如果指定的是下一跳地址路由器还需要再查找一次路由表以便确定送出接口，所以推荐用送出接口直接指定；但是对于以太网由于同一网段内可能不止两个接口，所以最好同时指定下一跳地址和送出接口。总之，对于串行链路指定送出接口，对于以太网接口指定下一跳地址和送出接口

#### 默认路由

其实默认路由和路由汇总的目的都是减小路由表的数目，路由汇总实际上就是CIDR的概念，即通过减小子网掩码中1的个数，来将多个小的子网汇总成一个大的网络。这里说默认路由通常用于截断网络（stub
network，也叫截断网络），这种网络有且仅有一个出口路由器

### 路由信息协议（routing infomation protocol，RIP）

#### 度量和管理距离

度量（metric）是用来权衡通过同种路由协议获得的到达相同网段的多个路由条目的重要性，通常包括跳数，带宽，延迟，负载，可靠性和开销；管理距离（administrative
distance，AD）用于权衡通过不同协议获得的到达相同网段的多个路由条目的重要性。也就是说先比较管理距离，再比较度量。下表是不同路由协议的管理距离总结：

  ----------- --------
  路由类型    默认AD
  直连路由    0
  静态路由    1
  EIGRP       90
  IGRP        100
  OSPF        110
  RIP         120
  外部EIGRP   170
  未知路由    255
  ----------- --------

其中未知路由不会被使用。

#### 路由环路及解决办法

路由环路的根本原因是距离矢量路由协议的收敛速度慢，它是这样一种状态：两个相邻的路由器都认为能通过各自到达一个已经关闭的网络，数据包在两个路由器之间来回传播直到ttl等于0为止。解决办法由如下几种：

设置最大跳数（maximum hop count）

路由环路实际上就是一个计数到无穷大的过程，可以设定一个上限，达到上限就认为目的网络不可达，这个上限就是最大跳数，RIP的最大跳数是15，计数至就认为目的网络不可达。

水平分割（split horizon）

通过特定接口接收到并学习的路由信息不会再从对应接口发送出去。

路由毒化（route poisoning）

当一个网络出问题时与其相连的路由器将对应网段标记为不可达，当接收到不可达的路由信息时接收路由器再将不可达路由信息反向发给发送方，这样就确保了所有路由器都接收到这个不可达路由信息，这个过程叫毒性反转（poison
reserve）

保持关闭（holddowns）

对于关闭网络设定一个定时器，超时后再发送相应的路由信息，有效防止频繁开关的网络影响网络收敛（convergence）

RIP的各种定时器

  ---------------- -------------------------- ---------------
  名称             作用                       时间（单位s）
  更新定时器       发送路由更新时间           30
  失效定时器       认定路由失效等待的时间     180
  保持失效定时器   不可达路由信息的保持时间   180
  刷新计时器       无效路由器删除前等待时间   240
  ---------------- -------------------------- ---------------

#### 相关配置命令

1.  启动rip并启动路由配置模式\#router rip
2.  设置参加路由协议的网络\#network
3.  其他命令

-   -   排除不参与路由协议的接口：passive-interface，但要注意这个接口还是会接收路由更新的，只是不会发送了。
    -   设置默认网络：default-infomation originate

#### 连续网络问题

这个问题能很有意思，通过这个例子也能更好的理解RIPv1和RIPv2的区别。

[![route-ripv1-discontiguousnetworks](/wp-content/uploads/2010/10/route-ripv1-discontiguousnetworks.jpg "route-ripv1-discontiguousnetworks")](/wp-content/uploads/2010/10/route-ripv1-discontiguousnetworks.jpg)

有类网络172.30.0.0的三个子网172.30.1.0，172.30.2.0，172.30.100.0被不同的有类网络的子网209.265.200.228和209.265.200.232分隔开。由于RIPv1是有类网络在更新中只发送有类网络的路由信息这是最根本的问题，R2会认为到达172.30.0.0有两条路径且度量相等，所以会执行等价均衡负载，R1和R3也不能学习到各自相连的网络。

如果我们将路由协议改为RIPv2仍然会出现这个问题，这是因为路由器在发送路由更新时会自动把有类网络的子网汇总到有类网络，而忽略了子网的路由信息，这是不连续网络问题的另一个原因。

#### RIPv2与RIPv1的区别

下表总结了两个版本的区别

  ------------------ -----------------------
  RIPv1              RIPv2
  有类               无类
  广播更新           组播更新（224.0.0.9）
  不支持不连续网络   支持连续网络
  不支持验证         支持验证
  ------------------ -----------------------


